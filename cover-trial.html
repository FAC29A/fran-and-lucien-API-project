<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form>
        <h1>Author Search</h1>
        <label for="author">Search for an author by name</label>
        <input id="author" name="author" type="search" required />
        <button type="submit">Search</button>
        <output></output>
      </form>


    <script>
      const form = document.querySelector("form");
        const output = document.querySelector("output");

        form.addEventListener("submit", (event) => {
            event.preventDefault();
            output.innerHTML = "";

            const formData = new FormData(form);
            const name = formData.get("author");

            fetch(`https://openlibrary.org/search.json?author=${name}&limit=6`)
                .then((response) => {
                    if (!response.ok) throw new Error(response.status);
                    return response.json();
                })
                .then((authorData) => {
                    displayResults(authorData); 
                })
                 .catch((error) => {
                    console.log(error);
                    if (error.message === "404") {
                        output.textContent = `⚠️ Couldn't find "${name}"`;
                    } else {
                        output.textContent = "⚠️ Something went wrong";
                    }
                    
                })
                
        });

        function extractOLIdentifier(key) {
        // Remove "/works/" from the key string
        return key.replace('/books/', '');
}

        async function fetchBookCover(olid) {
            return fetch(`https://covers.openlibrary.org/b/olid/${olid}-L.jpg`)
            .then((response) => {
                if (!response.ok) throw new Error(response.status);
                return response.url; // Return the URL of the book cover image
            });
        }


        async function displayResults(authorData) {
            const works = authorData.docs;

            if (works && works.length > 0) {
                const resultList = document.createElement('ul');

                for (const work of works) {
                    const li = document.createElement('li');
                    const olIdentifier = extractOLIdentifier(work.seed[1]); // Extract OL identifier
                    li.textContent = `Title: ${work.title} - Author(s): ${work.author_name.join(', ')} - ID: ${olIdentifier}`;

                    // Fetch and display book cover
                    try {
                        const bookCoverURL = await fetchBookCover(olIdentifier);
                        const img = document.createElement('img');
                        img.src = bookCoverURL;
                        li.appendChild(img);
                    } catch (error) {
                        console.log(`Error fetching book cover for ${work.title}: ${error.message}`);
                    }

                    resultList.appendChild(li);
                }

                output.appendChild(resultList);
            } else {
                output.textContent = 'No results found.';
            }
        }

        

    </script>
</body>
</html>


